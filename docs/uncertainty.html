<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7.3 Uncertainty | MLE for Political Science</title>
  <meta name="description" content="7.3 Uncertainty | MLE for Political Science" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="7.3 Uncertainty | MLE for Political Science" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7.3 Uncertainty | MLE for Political Science" />
  
  
  

<meta name="author" content="Instructor: Katie McCabe" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="qoi-at-designated-values.html"/>
<link rel="next" href="visualizing-results.html"/>
<script src="libs/header-attrs-2.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/vembedr-0.1.4/css/vembedr.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Course Overview</a></li>
<li class="chapter" data-level="2" data-path="rover.html"><a href="rover.html"><i class="fa fa-check"></i><b>2</b> R Overview</a>
<ul>
<li class="chapter" data-level="2.1" data-path="first-time-with-r-and-rstudio.html"><a href="first-time-with-r-and-rstudio.html"><i class="fa fa-check"></i><b>2.1</b> First Time with R and RStudio</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="first-time-with-r-and-rstudio.html"><a href="first-time-with-r-and-rstudio.html#open-rstudio"><i class="fa fa-check"></i><b>2.1.1</b> <strong>Open RStudio</strong></a></li>
<li class="chapter" data-level="2.1.2" data-path="first-time-with-r-and-rstudio.html"><a href="first-time-with-r-and-rstudio.html#using-r-as-a-calculator"><i class="fa fa-check"></i><b>2.1.2</b> <strong>Using R as a Calculator</strong></a></li>
<li class="chapter" data-level="2.1.3" data-path="first-time-with-r-and-rstudio.html"><a href="first-time-with-r-and-rstudio.html#working-in-an-r-script"><i class="fa fa-check"></i><b>2.1.3</b> <strong>Working in an R Script</strong></a></li>
<li class="chapter" data-level="2.1.4" data-path="first-time-with-r-and-rstudio.html"><a href="first-time-with-r-and-rstudio.html#preparing-your-r-script"><i class="fa fa-check"></i><b>2.1.4</b> <strong>Preparing your R script</strong></a></li>
<li class="chapter" data-level="2.1.5" data-path="first-time-with-r-and-rstudio.html"><a href="first-time-with-r-and-rstudio.html#executing-commands-in-your-r-script"><i class="fa fa-check"></i><b>2.1.5</b> <strong>Executing Commands in your R script</strong></a></li>
<li class="chapter" data-level="2.1.6" data-path="first-time-with-r-and-rstudio.html"><a href="first-time-with-r-and-rstudio.html#objects"><i class="fa fa-check"></i><b>2.1.6</b> <strong>Objects</strong></a></li>
<li class="chapter" data-level="2.1.7" data-path="first-time-with-r-and-rstudio.html"><a href="first-time-with-r-and-rstudio.html#practice"><i class="fa fa-check"></i><b>2.1.7</b> <strong>Practice</strong></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="tutorials.html"><a href="tutorials.html"><i class="fa fa-check"></i><b>2.2</b> Tutorials</a></li>
<li class="chapter" data-level="2.3" data-path="data-wrangling.html"><a href="data-wrangling.html"><i class="fa fa-check"></i><b>2.3</b> Data Wrangling</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="data-wrangling.html"><a href="data-wrangling.html#dealing-with-uninformative-variable-names"><i class="fa fa-check"></i><b>2.3.1</b> Dealing with Uninformative Variable Names</a></li>
<li class="chapter" data-level="2.3.2" data-path="data-wrangling.html"><a href="data-wrangling.html#dealing-with-missing-data"><i class="fa fa-check"></i><b>2.3.2</b> Dealing with Missing Data</a></li>
<li class="chapter" data-level="2.3.3" data-path="data-wrangling.html"><a href="data-wrangling.html#dealing-with-variable-codings-that-arent-quite-right"><i class="fa fa-check"></i><b>2.3.3</b> Dealing with Variable Codings that Aren’t Quite Right</a></li>
<li class="chapter" data-level="2.3.4" data-path="data-wrangling.html"><a href="data-wrangling.html#dealing-with-incomplete-data-merging"><i class="fa fa-check"></i><b>2.3.4</b> Dealing with Incomplete Data (Merging!)</a></li>
<li class="chapter" data-level="2.3.5" data-path="data-wrangling.html"><a href="data-wrangling.html#dealing-with-poorly-shaped-data"><i class="fa fa-check"></i><b>2.3.5</b> Dealing with Poorly Shaped Data</a></li>
<li class="chapter" data-level="2.3.6" data-path="data-wrangling.html"><a href="data-wrangling.html#reproducing-your-steps"><i class="fa fa-check"></i><b>2.3.6</b> Reproducing your steps</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="tools-for-writing-up-results.html"><a href="tools-for-writing-up-results.html"><i class="fa fa-check"></i><b>2.4</b> Tools for writing up results</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="tools-for-writing-up-results.html"><a href="tools-for-writing-up-results.html#r-markdown"><i class="fa fa-check"></i><b>2.4.1</b> R Markdown</a></li>
<li class="chapter" data-level="2.4.2" data-path="tools-for-writing-up-results.html"><a href="tools-for-writing-up-results.html#latex"><i class="fa fa-check"></i><b>2.4.2</b> LaTex</a></li>
<li class="chapter" data-level="2.4.3" data-path="tools-for-writing-up-results.html"><a href="tools-for-writing-up-results.html#formatting-and-exporting-r-results"><i class="fa fa-check"></i><b>2.4.3</b> Formatting and Exporting R Results</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="math.html"><a href="math.html"><i class="fa fa-check"></i><b>3</b> The MATH</a>
<ul>
<li class="chapter" data-level="3.1" data-path="mathematical-operations.html"><a href="mathematical-operations.html"><i class="fa fa-check"></i><b>3.1</b> Mathematical Operations</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="mathematical-operations.html"><a href="mathematical-operations.html#order-of-operations"><i class="fa fa-check"></i><b>3.1.1</b> <strong>Order of Operations</strong></a></li>
<li class="chapter" data-level="3.1.2" data-path="mathematical-operations.html"><a href="mathematical-operations.html#exponents"><i class="fa fa-check"></i><b>3.1.2</b> <strong>Exponents</strong></a></li>
<li class="chapter" data-level="3.1.3" data-path="mathematical-operations.html"><a href="mathematical-operations.html#summations-and-products"><i class="fa fa-check"></i><b>3.1.3</b> <strong>Summations and Products</strong></a></li>
<li class="chapter" data-level="3.1.4" data-path="mathematical-operations.html"><a href="mathematical-operations.html#logarithms"><i class="fa fa-check"></i><b>3.1.4</b> <strong>Logarithms</strong></a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="mathematical-operations-in-r.html"><a href="mathematical-operations-in-r.html"><i class="fa fa-check"></i><b>3.2</b> Mathematical Operations in R</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="mathematical-operations-in-r.html"><a href="mathematical-operations-in-r.html#pemdas"><i class="fa fa-check"></i><b>3.2.1</b> PEMDAS</a></li>
<li class="chapter" data-level="3.2.2" data-path="mathematical-operations-in-r.html"><a href="mathematical-operations-in-r.html#exponents-1"><i class="fa fa-check"></i><b>3.2.2</b> Exponents</a></li>
<li class="chapter" data-level="3.2.3" data-path="mathematical-operations-in-r.html"><a href="mathematical-operations-in-r.html#summations"><i class="fa fa-check"></i><b>3.2.3</b> Summations</a></li>
<li class="chapter" data-level="3.2.4" data-path="mathematical-operations-in-r.html"><a href="mathematical-operations-in-r.html#logarithms-1"><i class="fa fa-check"></i><b>3.2.4</b> Logarithms</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="derivatives.html"><a href="derivatives.html"><i class="fa fa-check"></i><b>3.3</b> Derivatives</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="derivatives.html"><a href="derivatives.html#derivatives-1"><i class="fa fa-check"></i><b>3.3.1</b> <strong>Derivatives</strong></a></li>
<li class="chapter" data-level="3.3.2" data-path="derivatives.html"><a href="derivatives.html#critical-points-for-minima-or-maxima"><i class="fa fa-check"></i><b>3.3.2</b> <strong>Critical Points for Minima or Maxima</strong></a></li>
<li class="chapter" data-level="3.3.3" data-path="derivatives.html"><a href="derivatives.html#common-derivative-rules"><i class="fa fa-check"></i><b>3.3.3</b> <strong>Common Derivative Rules</strong></a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="vectors-and-matrices.html"><a href="vectors-and-matrices.html"><i class="fa fa-check"></i><b>3.4</b> Vectors and Matrices</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="vectors-and-matrices.html"><a href="vectors-and-matrices.html#matrix-basics"><i class="fa fa-check"></i><b>3.4.1</b> <strong>Matrix Basics</strong></a></li>
<li class="chapter" data-level="3.4.2" data-path="vectors-and-matrices.html"><a href="vectors-and-matrices.html#matrix-operations"><i class="fa fa-check"></i><b>3.4.2</b> Matrix Operations</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="additional-matrix-tidbits-that-will-come-up.html"><a href="additional-matrix-tidbits-that-will-come-up.html"><i class="fa fa-check"></i><b>3.5</b> Additional Matrix Tidbits that Will Come Up</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="additional-matrix-tidbits-that-will-come-up.html"><a href="additional-matrix-tidbits-that-will-come-up.html#transpose"><i class="fa fa-check"></i><b>3.5.1</b> <strong>Transpose</strong></a></li>
<li class="chapter" data-level="3.5.2" data-path="additional-matrix-tidbits-that-will-come-up.html"><a href="additional-matrix-tidbits-that-will-come-up.html#additional-matrix-properties-and-rules"><i class="fa fa-check"></i><b>3.5.2</b> <strong>Additional Matrix Properties and Rules</strong></a></li>
<li class="chapter" data-level="3.5.3" data-path="additional-matrix-tidbits-that-will-come-up.html"><a href="additional-matrix-tidbits-that-will-come-up.html#matrix-rules"><i class="fa fa-check"></i><b>3.5.3</b> <strong>Matrix Rules</strong></a></li>
<li class="chapter" data-level="3.5.4" data-path="additional-matrix-tidbits-that-will-come-up.html"><a href="additional-matrix-tidbits-that-will-come-up.html#derivatives-with-matrices-and-vectors"><i class="fa fa-check"></i><b>3.5.4</b> <strong>Derivatives with Matrices and Vectors</strong></a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="practice-problems.html"><a href="practice-problems.html"><i class="fa fa-check"></i><b>3.6</b> Practice Problems</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="practice-problems.html"><a href="practice-problems.html#practice-problem-solutions"><i class="fa fa-check"></i><b>3.6.1</b> Practice Problem Solutions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ols.html"><a href="ols.html"><i class="fa fa-check"></i><b>4</b> Review of OLS</a>
<ul>
<li class="chapter" data-level="4.1" data-path="introducing-ols-regression.html"><a href="introducing-ols-regression.html"><i class="fa fa-check"></i><b>4.1</b> Introducing OLS Regression</a></li>
<li class="chapter" data-level="4.2" data-path="diving-deeper-into-ols-matrix-representation.html"><a href="diving-deeper-into-ols-matrix-representation.html"><i class="fa fa-check"></i><b>4.2</b> Diving Deeper into OLS Matrix Representation</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="diving-deeper-into-ols-matrix-representation.html"><a href="diving-deeper-into-ols-matrix-representation.html#estimating-the-coefficients"><i class="fa fa-check"></i><b>4.2.1</b> Estimating the Coefficients</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="ols-regression-in-r.html"><a href="ols-regression-in-r.html"><i class="fa fa-check"></i><b>4.3</b> OLS Regression in R</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="ols-regression-in-r.html"><a href="ols-regression-in-r.html#example-predicting-current-election-votes-from-past-election-votes"><i class="fa fa-check"></i><b>4.3.1</b> Example: Predicting Current Election Votes from Past Election Votes</a></li>
<li class="chapter" data-level="4.3.2" data-path="ols-regression-in-r.html"><a href="ols-regression-in-r.html#plotting-regression-results"><i class="fa fa-check"></i><b>4.3.2</b> Plotting Regression Results</a></li>
<li class="chapter" data-level="4.3.3" data-path="ols-regression-in-r.html"><a href="ols-regression-in-r.html#finding-coefficients-without-lm"><i class="fa fa-check"></i><b>4.3.3</b> Finding Coefficients without <code>lm</code></a></li>
<li class="chapter" data-level="4.3.4" data-path="ols-regression-in-r.html"><a href="ols-regression-in-r.html#ols-practice-problems"><i class="fa fa-check"></i><b>4.3.4</b> OLS Practice Problems</a></li>
<li class="chapter" data-level="4.3.5" data-path="ols-regression-in-r.html"><a href="ols-regression-in-r.html#code-for-solutions"><i class="fa fa-check"></i><b>4.3.5</b> Code for solutions</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="week-1-thursday-tutorial.html"><a href="week-1-thursday-tutorial.html"><i class="fa fa-check"></i><b>4.4</b> Week 1 Thursday Tutorial</a></li>
<li class="chapter" data-level="4.5" data-path="uncertainty-and-regression.html"><a href="uncertainty-and-regression.html"><i class="fa fa-check"></i><b>4.5</b> Uncertainty and Regression</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="uncertainty-and-regression.html"><a href="uncertainty-and-regression.html#variance-of-the-coefficients"><i class="fa fa-check"></i><b>4.5.1</b> Variance of the Coefficients</a></li>
<li class="chapter" data-level="4.5.2" data-path="uncertainty-and-regression.html"><a href="uncertainty-and-regression.html#hypothesis-testing"><i class="fa fa-check"></i><b>4.5.2</b> Hypothesis Testing</a></li>
<li class="chapter" data-level="4.5.3" data-path="uncertainty-and-regression.html"><a href="uncertainty-and-regression.html#goodness-of-fit"><i class="fa fa-check"></i><b>4.5.3</b> Goodness of Fit</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="generating-predictions-from-regression-models.html"><a href="generating-predictions-from-regression-models.html"><i class="fa fa-check"></i><b>4.6</b> Generating predictions from regression models</a></li>
<li class="chapter" data-level="4.7" data-path="wrapping-up-ols.html"><a href="wrapping-up-ols.html"><i class="fa fa-check"></i><b>4.7</b> Wrapping up OLS</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="practice-problems.html"><a href="practice-problems.html#practice-problems"><i class="fa fa-check"></i><b>4.7.1</b> Practice Problems</a></li>
<li class="chapter" data-level="4.7.2" data-path="wrapping-up-ols.html"><a href="wrapping-up-ols.html#practice-problem-code-for-solutions"><i class="fa fa-check"></i><b>4.7.2</b> Practice Problem Code for Solutions</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="week-2-thursday-example.html"><a href="week-2-thursday-example.html"><i class="fa fa-check"></i><b>4.8</b> Week 2 Thursday Example</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="mle.html"><a href="mle.html"><i class="fa fa-check"></i><b>5</b> Introduction to MLE</a>
<ul>
<li class="chapter" data-level="5.1" data-path="what-is-likelihood.html"><a href="what-is-likelihood.html"><i class="fa fa-check"></i><b>5.1</b> What is likelihood?</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="what-is-likelihood.html"><a href="what-is-likelihood.html#summarizing-steps-for-maximum-likelihood"><i class="fa fa-check"></i><b>5.1.1</b> Summarizing Steps for Maximum Likelihood</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html"><i class="fa fa-check"></i><b>5.2</b> Generalized Linear Models</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#glm-model."><i class="fa fa-check"></i><b>5.2.1</b> GLM Model.</a></li>
<li class="chapter" data-level="5.2.2" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#linking-likelihood-and-the-glm"><i class="fa fa-check"></i><b>5.2.2</b> Linking likelihood and the GLM</a></li>
<li class="chapter" data-level="5.2.3" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#glm-in-r"><i class="fa fa-check"></i><b>5.2.3</b> GLM in R</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="mle-estimation.html"><a href="mle-estimation.html"><i class="fa fa-check"></i><b>5.3</b> MLE Estimation</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="mle-estimation.html"><a href="mle-estimation.html#deriving-estimators"><i class="fa fa-check"></i><b>5.3.1</b> Deriving Estimators</a></li>
<li class="chapter" data-level="5.3.2" data-path="mle-estimation.html"><a href="mle-estimation.html#score-function"><i class="fa fa-check"></i><b>5.3.2</b> Score function</a></li>
<li class="chapter" data-level="5.3.3" data-path="mle-estimation.html"><a href="mle-estimation.html#hessian-and-information-matrix"><i class="fa fa-check"></i><b>5.3.3</b> Hessian and Information Matrix</a></li>
<li class="chapter" data-level="5.3.4" data-path="mle-estimation.html"><a href="mle-estimation.html#mle-estimation-algorithm"><i class="fa fa-check"></i><b>5.3.4</b> MLE Estimation Algorithm</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="mle-properties.html"><a href="mle-properties.html"><i class="fa fa-check"></i><b>5.4</b> MLE Properties</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="mle-properties.html"><a href="mle-properties.html#hypothesis-tests"><i class="fa fa-check"></i><b>5.4.1</b> Hypothesis Tests</a></li>
<li class="chapter" data-level="5.4.2" data-path="mle-properties.html"><a href="mle-properties.html#model-output-in-r"><i class="fa fa-check"></i><b>5.4.2</b> Model Output in R</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="binary.html"><a href="binary.html"><i class="fa fa-check"></i><b>6</b> Binary Dependent Variables</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data-generating-process.html"><a href="data-generating-process.html"><i class="fa fa-check"></i><b>6.1</b> Data Generating Process</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="mle-estimation.html"><a href="mle-estimation.html#mle-estimation"><i class="fa fa-check"></i><b>6.1.1</b> MLE Estimation</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="r-code-for-fitting-logistic-regression.html"><a href="r-code-for-fitting-logistic-regression.html"><i class="fa fa-check"></i><b>6.2</b> R code for fitting logistic regression</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="r-code-for-fitting-logistic-regression.html"><a href="r-code-for-fitting-logistic-regression.html#writing-down-the-regression-model"><i class="fa fa-check"></i><b>6.2.1</b> Writing down the regression model</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="probit-regression.html"><a href="probit-regression.html"><i class="fa fa-check"></i><b>6.3</b> Probit Regression</a></li>
<li class="chapter" data-level="6.4" data-path="to-logit-or-to-probit.html"><a href="to-logit-or-to-probit.html"><i class="fa fa-check"></i><b>6.4</b> To logit or to probit?</a></li>
<li class="chapter" data-level="6.5" data-path="latent-propensity-representation.html"><a href="latent-propensity-representation.html"><i class="fa fa-check"></i><b>6.5</b> Latent propensity representation</a></li>
<li class="chapter" data-level="6.6" data-path="linear-probability-models.html"><a href="linear-probability-models.html"><i class="fa fa-check"></i><b>6.6</b> Linear Probability Models</a></li>
<li class="chapter" data-level="6.7" data-path="week-3-tutorial.html"><a href="week-3-tutorial.html"><i class="fa fa-check"></i><b>6.7</b> Week 3 Tutorial</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="week-3-tutorial.html"><a href="week-3-tutorial.html#loading-data-and-fitting-glm"><i class="fa fa-check"></i><b>6.7.1</b> Loading data and fitting glm</a></li>
<li class="chapter" data-level="6.7.2" data-path="week-3-tutorial.html"><a href="week-3-tutorial.html#numeric-optimization"><i class="fa fa-check"></i><b>6.7.2</b> Numeric Optimization</a></li>
<li class="chapter" data-level="6.7.3" data-path="week-3-tutorial.html"><a href="week-3-tutorial.html#predicted-probabilities"><i class="fa fa-check"></i><b>6.7.3</b> Predicted Probabilities</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="qoi.html"><a href="qoi.html"><i class="fa fa-check"></i><b>7</b> Quantities of Interest</a>
<ul>
<li class="chapter" data-level="7.1" data-path="using-the-response-functions-to-generate-quantities-of-interest.html"><a href="using-the-response-functions-to-generate-quantities-of-interest.html"><i class="fa fa-check"></i><b>7.1</b> Using the response functions to generate quantities of interest</a></li>
<li class="chapter" data-level="7.2" data-path="qoi-at-designated-values.html"><a href="qoi-at-designated-values.html"><i class="fa fa-check"></i><b>7.2</b> QOI at Designated Values</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="qoi-at-designated-values.html"><a href="qoi-at-designated-values.html#marginal-effects"><i class="fa fa-check"></i><b>7.2.1</b> Marginal Effects</a></li>
<li class="chapter" data-level="7.2.2" data-path="qoi-at-designated-values.html"><a href="qoi-at-designated-values.html#marginal-effects-at-the-mean"><i class="fa fa-check"></i><b>7.2.2</b> Marginal effects at the mean</a></li>
<li class="chapter" data-level="7.2.3" data-path="qoi-at-designated-values.html"><a href="qoi-at-designated-values.html#marginal-effects-at-representative-values"><i class="fa fa-check"></i><b>7.2.3</b> Marginal effects at representative values</a></li>
<li class="chapter" data-level="7.2.4" data-path="qoi-at-designated-values.html"><a href="qoi-at-designated-values.html#average-marginal-effects"><i class="fa fa-check"></i><b>7.2.4</b> Average marginal effects</a></li>
<li class="chapter" data-level="7.2.5" data-path="qoi-at-designated-values.html"><a href="qoi-at-designated-values.html#prediction-and-margins-packages."><i class="fa fa-check"></i><b>7.2.5</b> <code>prediction</code> and <code>margins</code> packages.</a></li>
<li class="chapter" data-level="7.2.6" data-path="qoi-at-designated-values.html"><a href="qoi-at-designated-values.html#qoi-practice-problems"><i class="fa fa-check"></i><b>7.2.6</b> QOI Practice Problems</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="uncertainty.html"><a href="uncertainty.html"><i class="fa fa-check"></i><b>7.3</b> Uncertainty</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="uncertainty.html"><a href="uncertainty.html#bootstrapping"><i class="fa fa-check"></i><b>7.3.1</b> Bootstrapping</a></li>
<li class="chapter" data-level="7.3.2" data-path="uncertainty.html"><a href="uncertainty.html#simulated-confidence-intervals"><i class="fa fa-check"></i><b>7.3.2</b> Simulated Confidence Intervals</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="visualizing-results.html"><a href="visualizing-results.html"><i class="fa fa-check"></i><b>7.4</b> Visualizing Results</a></li>
<li class="chapter" data-level="7.5" data-path="additional-r-shortcuts.html"><a href="additional-r-shortcuts.html"><i class="fa fa-check"></i><b>7.5</b> Additional R shortcuts</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="additional-r-shortcuts.html"><a href="additional-r-shortcuts.html#prediction"><i class="fa fa-check"></i><b>7.5.1</b> Prediction</a></li>
<li class="chapter" data-level="7.5.2" data-path="additional-r-shortcuts.html"><a href="additional-r-shortcuts.html#margins"><i class="fa fa-check"></i><b>7.5.2</b> Margins</a></li>
<li class="chapter" data-level="7.5.3" data-path="additional-r-shortcuts.html"><a href="additional-r-shortcuts.html#zelig"><i class="fa fa-check"></i><b>7.5.3</b> Zelig</a></li>
<li class="chapter" data-level="7.5.4" data-path="additional-r-shortcuts.html"><a href="additional-r-shortcuts.html#using-expand.grid"><i class="fa fa-check"></i><b>7.5.4</b> Using <code>expand.grid</code></a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="week-4-tutorial.html"><a href="week-4-tutorial.html"><i class="fa fa-check"></i><b>7.6</b> Week 4 Tutorial</a></li>
<li class="chapter" data-level="7.7" data-path="putting-everything-together.html"><a href="putting-everything-together.html"><i class="fa fa-check"></i><b>7.7</b> Putting everything together</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="ordinal.html"><a href="ordinal.html"><i class="fa fa-check"></i><b>8</b> Ordinal Outcomes</a>
<ul>
<li class="chapter" data-level="8.1" data-path="ordinal-outcome-data.html"><a href="ordinal-outcome-data.html"><i class="fa fa-check"></i><b>8.1</b> Ordinal Outcome Data</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="ordinal-outcome-data.html"><a href="ordinal-outcome-data.html#ordinal-model"><i class="fa fa-check"></i><b>8.1.1</b> Ordinal Model</a></li>
<li class="chapter" data-level="8.1.2" data-path="ordinal-outcome-data.html"><a href="ordinal-outcome-data.html#interpretation"><i class="fa fa-check"></i><b>8.1.2</b> Interpretation</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="likelihood-framework.html"><a href="likelihood-framework.html"><i class="fa fa-check"></i><b>8.2</b> Likelihood Framework</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="likelihood-framework.html"><a href="likelihood-framework.html#likelihood"><i class="fa fa-check"></i><b>8.2.1</b> Likelihood</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="fitting-ordinal-models-in-r.html"><a href="fitting-ordinal-models-in-r.html"><i class="fa fa-check"></i><b>8.3</b> Fitting Ordinal Models in R</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="fitting-ordinal-models-in-r.html"><a href="fitting-ordinal-models-in-r.html#quantities-of-interest"><i class="fa fa-check"></i><b>8.3.1</b> Quantities of Interest</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="assumptions.html"><a href="assumptions.html"><i class="fa fa-check"></i><b>8.4</b> Assumptions</a></li>
<li class="chapter" data-level="8.5" data-path="ordinal-practice-problems.html"><a href="ordinal-practice-problems.html"><i class="fa fa-check"></i><b>8.5</b> Ordinal Practice Problems</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="ordinal-practice-problems.html"><a href="ordinal-practice-problems.html#a-note-on-robust-standard-errors"><i class="fa fa-check"></i><b>8.5.1</b> A note on robust standard errors</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="week-6-tutorial.html"><a href="week-6-tutorial.html"><i class="fa fa-check"></i><b>8.6</b> Week 6 Tutorial</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="ml.html"><a href="ml.html"><i class="fa fa-check"></i><b>9</b> Multinomial Outcomes</a>
<ul>
<li class="chapter" data-level="9.1" data-path="overview-of-nominal-data.html"><a href="overview-of-nominal-data.html"><i class="fa fa-check"></i><b>9.1</b> Overview of Nominal Data</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="overview-of-nominal-data.html"><a href="overview-of-nominal-data.html#multinomial-likelihood"><i class="fa fa-check"></i><b>9.1.1</b> Multinomial Likelihood</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="motivating-example.html"><a href="motivating-example.html"><i class="fa fa-check"></i><b>9.2</b> Motivating Example</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="motivating-example.html"><a href="motivating-example.html#assumption-and-considerations"><i class="fa fa-check"></i><b>9.2.1</b> Assumption and Considerations</a></li>
<li class="chapter" data-level="9.2.2" data-path="motivating-example.html"><a href="motivating-example.html#key-assumption-independence-of-irrelevant-alternatives"><i class="fa fa-check"></i><b>9.2.2</b> Key Assumption: Independence of Irrelevant Alternatives</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="running-multinomial-logit-in-r.html"><a href="running-multinomial-logit-in-r.html"><i class="fa fa-check"></i><b>9.3</b> Running multinomial logit in R</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="running-multinomial-logit-in-r.html"><a href="running-multinomial-logit-in-r.html#multinomial-quantities-of-interest"><i class="fa fa-check"></i><b>9.3.1</b> Multinomial Quantities of Interest</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="practice-problems-for-multinomial.html"><a href="practice-problems-for-multinomial.html"><i class="fa fa-check"></i><b>9.4</b> Practice Problems for Multinomial</a></li>
<li class="chapter" data-level="9.5" data-path="week-7-tutorial.html"><a href="week-7-tutorial.html"><i class="fa fa-check"></i><b>9.5</b> Week 7 Tutorial</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MLE for Political Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="uncertainty" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Uncertainty</h2>
<p>Usually, we want to report a confidence interval around our predicted probabilities, average predicted probabilities, or around the difference in our predicted probabilities or difference in our average predicted probabilities.</p>
<p>This is different from the uncertainty of a coefficient, which we already have from our <code>glm</code> output. Here, if we say there is a 0.01 probability of a dispute, that is just an estimate, it is going to vary over repeated samples. We want to generate a confidence interval that represents this variability in <span class="math inline">\(\hat \pi\)</span>.</p>
<p>We have already discussed using the <code>predict</code> function in <code>lm</code> to generate confidence intervals for OLS estimates. In a limited set of cases, we can also use this shortcut for <code>glm</code> by taking advantage of the distribution being approximately normal on the scale of the linear predictor. When we are estimating confidence intervals around 1) one or multiple single quantities of interest (a predicted probability, as opposed to a difference in predicted probability) 2) where the <span class="math inline">\(X\)</span> values are set at specific values (and not at their observed values) then, we can plug this into the <code>predict</code> function in the following way:</p>
<ol style="list-style-type: decimal">
<li>Generate the prediction and standard errors of the prediction on the <code>link</code> linear predictor scale.
<ul>
<li>On the scale of the linear predictor, the standard errors of the prediction are calculated as <span class="math inline">\(\sqrt{\mathbb{x&#39;}_c \text{vcov(fit)} \mathbb{x}_c}\)</span> using the delta method.</li>
</ul></li>
<li>Calculate the CI on the linear predictor scale: <span class="math inline">\(CI(\hat \theta) = \hat \theta - z_{crit}*se_{\hat \theta}\)</span> ; <span class="math inline">\(\hat \theta + z_{crit}*se_{\hat \theta}\)</span>
<ul>
<li><span class="math inline">\(z_{crit}\)</span> for the 95% confidence interval is 1.96 (so this is saying +/- about 2 standard errors). We get this by using <code>qnorm()</code>.</li>
</ul></li>
<li>Convert the prediction and confidence intervals to the response scale.</li>
</ol>
<p>Here is an example:</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="uncertainty.html#cb372-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Predicted probability when Allies = 1 and all other covariates = 0</span></span>
<span id="cb372-2"><a href="uncertainty.html#cb372-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Note type = &quot;link&quot;</span></span>
<span id="cb372-3"><a href="uncertainty.html#cb372-3" aria-hidden="true" tabindex="-1"></a>allies1.link <span class="ot">&lt;-</span> <span class="fu">predict</span>(out.logit, <span class="at">newdata =</span> </span>
<span id="cb372-4"><a href="uncertainty.html#cb372-4" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">data.frame</span>( <span class="at">MajorPower =</span> <span class="dv">0</span>,</span>
<span id="cb372-5"><a href="uncertainty.html#cb372-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">Contiguity =</span> <span class="dv">0</span>, </span>
<span id="cb372-6"><a href="uncertainty.html#cb372-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">Allies =</span> <span class="dv">1</span>, </span>
<span id="cb372-7"><a href="uncertainty.html#cb372-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">ForeignPolicy =</span> <span class="dv">0</span>,<span class="at">BalanceOfPower =</span> <span class="dv">0</span>, </span>
<span id="cb372-8"><a href="uncertainty.html#cb372-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">YearsSince =</span> <span class="dv">0</span>),</span>
<span id="cb372-9"><a href="uncertainty.html#cb372-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">type =</span> <span class="st">&quot;link&quot;</span>, <span class="at">se =</span> T)</span>
<span id="cb372-10"><a href="uncertainty.html#cb372-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-11"><a href="uncertainty.html#cb372-11" aria-hidden="true" tabindex="-1"></a>allies1 <span class="ot">&lt;-</span>  <span class="fu">plogis</span>(allies1.link<span class="sc">$</span>fit)</span>
<span id="cb372-12"><a href="uncertainty.html#cb372-12" aria-hidden="true" tabindex="-1"></a>allies1.lb <span class="ot">&lt;-</span> <span class="fu">plogis</span>(allies1.link<span class="sc">$</span>fit <span class="sc">-</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>)<span class="sc">*</span>allies1.link<span class="sc">$</span>se.fit)</span>
<span id="cb372-13"><a href="uncertainty.html#cb372-13" aria-hidden="true" tabindex="-1"></a>allies1.ub <span class="ot">&lt;-</span> <span class="fu">plogis</span>(allies1.link<span class="sc">$</span>fit <span class="sc">+</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>)<span class="sc">*</span>allies1.link<span class="sc">$</span>se.fit)</span>
<span id="cb372-14"><a href="uncertainty.html#cb372-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-15"><a href="uncertainty.html#cb372-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Confidence interval</span></span>
<span id="cb372-16"><a href="uncertainty.html#cb372-16" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(allies1, allies1.lb, allies1.ub)</span></code></pre></div>
<pre><code>          1           1           1 
0.002632504 0.001302711 0.005312514 </code></pre>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="uncertainty.html#cb374-1" aria-hidden="true" tabindex="-1"></a><span class="do">## By hand (using x as a k x 1 vector)</span></span>
<span id="cb374-2"><a href="uncertainty.html#cb374-2" aria-hidden="true" tabindex="-1"></a>x.c <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb374-3"><a href="uncertainty.html#cb374-3" aria-hidden="true" tabindex="-1"></a>se.hand <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">t</span>(x.c) <span class="sc">%*%</span> <span class="fu">vcov</span>(out.logit) <span class="sc">%*%</span> x.c)</span>
<span id="cb374-4"><a href="uncertainty.html#cb374-4" aria-hidden="true" tabindex="-1"></a>p.hand <span class="ot">&lt;-</span> <span class="fu">t</span>(x.c) <span class="sc">%*%</span> <span class="fu">coef</span>(out.logit)</span>
<span id="cb374-5"><a href="uncertainty.html#cb374-5" aria-hidden="true" tabindex="-1"></a>allies1.hand <span class="ot">&lt;-</span> <span class="fu">plogis</span>(p.hand)</span>
<span id="cb374-6"><a href="uncertainty.html#cb374-6" aria-hidden="true" tabindex="-1"></a>allies1.hand.lb <span class="ot">&lt;-</span> <span class="fu">plogis</span>(p.hand<span class="sc">-</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>)<span class="sc">*</span>se.hand)</span>
<span id="cb374-7"><a href="uncertainty.html#cb374-7" aria-hidden="true" tabindex="-1"></a>allies1.hand.ub <span class="ot">&lt;-</span> <span class="fu">plogis</span>(p.hand <span class="sc">+</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>)<span class="sc">*</span>se.hand)</span>
<span id="cb374-8"><a href="uncertainty.html#cb374-8" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(allies1.hand, allies1.hand.lb, allies1.hand.ub)</span></code></pre></div>
<pre><code>[1] 0.002632504 0.001302711 0.005312514</code></pre>
<p>Beyond this simple case, there are three general approaches to calculating the uncertainty of the quantities of interest. Here is a video with an overview of these three processes. The course notes contain additional detail below. It continues with the <a href="https://raw.githubusercontent.com/ktmccabe/teachingdata/main/anesdems.csv">anes data</a> example from Banda and Cassese in section 6, as did the other video in this section.</p>
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/BYE4TWV6Byc" width="533" height="300" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
<ul>
<li>Delta Method (based on calculus, first order Taylor Expansion approximation)</li>
<li>Bootstrapping (very flexible, common, computationally demanding)</li>
<li>Quasi-bayesian (flexible, less computationally demanding), also described as simulation/Monte carlo simulation.</li>
</ul>
<p>For now, we will focus on the second two methods, but some statistical software programs will report uncertainty estimates based on the Delta method. Here is more information on this <a href="https://stats.idre.ucla.edu/r/faq/how-can-i-estimate-the-standard-error-of-transformed-regression-parameters-in-r-using-the-delta-method/">method</a> and the <code>deltamethod</code> <a href="https://www.r-bloggers.com/2018/01/delta-method-standard-errors/">function</a> in R.</p>
<div id="bootstrapping" class="section level3" number="7.3.1">
<h3><span class="header-section-number">7.3.1</span> Bootstrapping</h3>
<p>Bootstrapping simulates the idea of conducting repeated samples to generate a distribution of estimates of your quantity of interests. We “resample” from our existing data to generate thousands of new datasets, and use each dataset to generate a slightly different quantity of interest. This distribution is then used to construct the confidence interval.</p>
<p>Process:</p>
<ul>
<li>Sample from the data to generate new data frame</li>
<li>Run the model: this gives new coefficient estimates and new covariate matrices</li>
<li>Use new coefficient and covariate estimates to compute quantity of interest</li>
<li>Replicate the previous process for about 1000 iterations to get 1000 estimates of quantity of interest</li>
<li>Use the distribution of these estimates to calculate confidence intervals</li>
</ul>
<p>Why? How does this work?</p>
<ul>
<li>It is simulating the exercise of hypothetical repeated samples</li>
<li>Similar to Law of Large Numbers- with sufficient iterations, the empirical “bootstrap” distribution is a good approximation of the true distribution (will get closer and closer to the truth)
<ul>
<li>It won’t help us correct a bad estimate– have to work from the data we have.</li>
</ul></li>
<li>The logic is we think the distribution of <span class="math inline">\(\bar x\)</span> sample estimate is centered on <span class="math inline">\(\mu\)</span> (the truth), and then we assume the distribution of <span class="math inline">\(\bar x*\)</span> (the bootstrapped estimate) is centered on <span class="math inline">\(\bar x\)</span></li>
</ul>
<p>This would be a good place to review the Bootstrap resources at the front of the section:</p>
<ul>
<li>Pezullo, John. <a href="https://www.dummies.com/education/science/biology/the-bootstrap-method-for-standard-errors-and-confidence-intervals/">The Bootstrap Method for Standard Errors and Confidence Intervals.</a></li>
<li>Banks, David. <a href="http://www2.stat.duke.edu/~banks/111-lectures.dir/lect13.pdf">Lecture from Duke University.</a></li>
</ul>
<p>How do we implement this procedure?</p>
<p><strong><em>Example</em></strong></p>
<p>Find the point estimate and 95% CI for the average predicted probability of conflict when the dyad are allies and all other covariates are held at observed values</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="uncertainty.html#cb376-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Original regression</span></span>
<span id="cb376-2"><a href="uncertainty.html#cb376-2" aria-hidden="true" tabindex="-1"></a>out.logit <span class="ot">&lt;-</span><span class="fu">glm</span>(Conflict <span class="sc">~</span>  MajorPower <span class="sc">+</span> Contiguity <span class="sc">+</span> Allies <span class="sc">+</span> ForeignPolicy <span class="sc">+</span></span>
<span id="cb376-3"><a href="uncertainty.html#cb376-3" aria-hidden="true" tabindex="-1"></a>    BalanceOfPower <span class="sc">+</span> YearsSince, </span>
<span id="cb376-4"><a href="uncertainty.html#cb376-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), <span class="at">data =</span> mids)</span>
<span id="cb376-5"><a href="uncertainty.html#cb376-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-6"><a href="uncertainty.html#cb376-6" aria-hidden="true" tabindex="-1"></a><span class="do">## We need to build our bootstrap procedure</span></span>
<span id="cb376-7"><a href="uncertainty.html#cb376-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Let&#39;s assume we just want 1 iteration</span></span>
<span id="cb376-8"><a href="uncertainty.html#cb376-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-9"><a href="uncertainty.html#cb376-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 1: sample to generate new data</span></span>
<span id="cb376-10"><a href="uncertainty.html#cb376-10" aria-hidden="true" tabindex="-1"></a><span class="do">## this selects N row numbers from mids, with replacement</span></span>
<span id="cb376-11"><a href="uncertainty.html#cb376-11" aria-hidden="true" tabindex="-1"></a>wrows <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x =</span><span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mids), <span class="at">size =</span> <span class="fu">nrow</span>(mids), <span class="at">replace =</span> T)</span>
<span id="cb376-12"><a href="uncertainty.html#cb376-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-13"><a href="uncertainty.html#cb376-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Create subset of data based on these rows</span></span>
<span id="cb376-14"><a href="uncertainty.html#cb376-14" aria-hidden="true" tabindex="-1"></a>subdata <span class="ot">&lt;-</span> mids[wrows, ]</span>
<span id="cb376-15"><a href="uncertainty.html#cb376-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-16"><a href="uncertainty.html#cb376-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 2: run your regression model with the new data</span></span>
<span id="cb376-17"><a href="uncertainty.html#cb376-17" aria-hidden="true" tabindex="-1"></a>boot.logit <span class="ot">&lt;-</span><span class="fu">glm</span>(Conflict <span class="sc">~</span>  MajorPower <span class="sc">+</span> Contiguity <span class="sc">+</span> Allies <span class="sc">+</span> ForeignPolicy <span class="sc">+</span></span>
<span id="cb376-18"><a href="uncertainty.html#cb376-18" aria-hidden="true" tabindex="-1"></a>    BalanceOfPower <span class="sc">+</span> YearsSince, </span>
<span id="cb376-19"><a href="uncertainty.html#cb376-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), <span class="at">data =</span> subdata)</span>
<span id="cb376-20"><a href="uncertainty.html#cb376-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-21"><a href="uncertainty.html#cb376-21" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 3: generate average predicted probability</span></span>
<span id="cb376-22"><a href="uncertainty.html#cb376-22" aria-hidden="true" tabindex="-1"></a>Xboot <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(boot.logit)</span>
<span id="cb376-23"><a href="uncertainty.html#cb376-23" aria-hidden="true" tabindex="-1"></a>Xboot[, <span class="st">&quot;Allies&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb376-24"><a href="uncertainty.html#cb376-24" aria-hidden="true" tabindex="-1"></a>Bh <span class="ot">&lt;-</span> <span class="fu">coef</span>(boot.logit)</span>
<span id="cb376-25"><a href="uncertainty.html#cb376-25" aria-hidden="true" tabindex="-1"></a>p.boot <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">plogis</span>(Xboot <span class="sc">%*%</span> Bh))</span></code></pre></div>
<details>
<summary>
Expand below for more details on what the sample function does.
</summary>
<p>Let’s say we have a dataframe of different colors and shapes.</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="uncertainty.html#cb377-1" aria-hidden="true" tabindex="-1"></a>somedata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">colors =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;yellow&quot;</span>, <span class="st">&quot;green&quot;</span>, </span>
<span id="cb377-2"><a href="uncertainty.html#cb377-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;purple&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;black&quot;</span>),</span>
<span id="cb377-3"><a href="uncertainty.html#cb377-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">shapes =</span> <span class="fu">c</span>(<span class="st">&quot;circle&quot;</span>, <span class="st">&quot;square&quot;</span>, <span class="st">&quot;triangle&quot;</span>, </span>
<span id="cb377-4"><a href="uncertainty.html#cb377-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;rectangle&quot;</span>, <span class="st">&quot;diamond&quot;</span>, <span class="st">&quot;line&quot;</span>, <span class="st">&quot;sphere&quot;</span>))</span>
<span id="cb377-5"><a href="uncertainty.html#cb377-5" aria-hidden="true" tabindex="-1"></a>somedata                                  </span></code></pre></div>
<pre><code>  colors    shapes
1    red    circle
2   blue    square
3 yellow  triangle
4  green rectangle
5 purple   diamond
6 orange      line
7  black    sphere</code></pre>
<p>I could generate a new “resampled” dataset with the <code>sample</code> function. We tell the function three things: 1) choose from the row numbers in my dataframe (<code>1:nrow(somedata)</code>), 2) pick <span class="math inline">\(N\)</span> row numbers in total (<code>nrow(somedata)</code>), 3) Each time you pick a given row number <span class="math inline">\(i\)</span>, put it back in the data, allowing the possibility that you may randomly sample it again (<code>replace = TRUE</code>).</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="uncertainty.html#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(somedata), <span class="fu">nrow</span>(somedata), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>[1] 7 7 5 2 7 5 4</code></pre>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="uncertainty.html#cb381-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(somedata), <span class="fu">nrow</span>(somedata), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>[1] 1 1 1 1 4 3 4</code></pre>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="uncertainty.html#cb383-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(somedata), <span class="fu">nrow</span>(somedata), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>[1] 3 3 2 1 7 1 5</code></pre>
<p>What happened is the function generated a set of row numbers. Note how it is possible for the same row number to be picked multiple times. Each time we run the sample function, we get slightly different row numbers.</p>
<p>We can subset our data based on these row indices.</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="uncertainty.html#cb385-1" aria-hidden="true" tabindex="-1"></a><span class="do">## store row indices</span></span>
<span id="cb385-2"><a href="uncertainty.html#cb385-2" aria-hidden="true" tabindex="-1"></a>wrows <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(somedata), <span class="fu">nrow</span>(somedata), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb385-3"><a href="uncertainty.html#cb385-3" aria-hidden="true" tabindex="-1"></a>wrows</span></code></pre></div>
<pre><code>[1] 4 6 2 2 6 1 2</code></pre>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="uncertainty.html#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="do">## subset data to include rows sampled</span></span>
<span id="cb387-2"><a href="uncertainty.html#cb387-2" aria-hidden="true" tabindex="-1"></a><span class="do">## note if row indices are in wrows more than once, they will also be in the subset more than once</span></span>
<span id="cb387-3"><a href="uncertainty.html#cb387-3" aria-hidden="true" tabindex="-1"></a>subdata <span class="ot">&lt;-</span> somedata[wrows,]</span>
<span id="cb387-4"><a href="uncertainty.html#cb387-4" aria-hidden="true" tabindex="-1"></a>subdata</span></code></pre></div>
<pre><code>    colors    shapes
4    green rectangle
6   orange      line
2     blue    square
2.1   blue    square
6.1 orange      line
1      red    circle
2.2   blue    square</code></pre>
<p>Given that each time the sample function runs, we get slightly different random samples of the data, that’s how we end up with a distribution of slightly different estimates of our quantities of interest. Each time the regression is run with a slightly different dataset.</p>
</details>
<p>This gives us one estimate of the average predicted probability stored in <code>p.boot</code>. However, the idea of a bootstrap is that we repeat this procedure at least 1000 times to generate a distribution of estimates of the quantity of interest, the average predicted probability in this case.</p>
<p>We could literally repeat that code chunk 1000 times…. but, we have better things to do than that much copy/paste. Instead, we will create a function that will do this automatically.</p>
<p>To do so, we are going to wrap our procedure above inside the syntax for creating functions in R. In R, to create a function,</p>
<ul>
<li>We first name the function. (Let’s call this <code>myboot</code>. You could call yours anything.)</li>
<li>The next syntax is always <code>myboot &lt;- function(){}</code>.</li>
<li>Inside the <code>function()</code> part, you tell R what you are going to supply the function each time you want it to run. Sometimes functions only have one input, others like <code>lm</code> have multiple inputs.
<ul>
<li>For example, in the function <code>mean(x)</code>, we always supply that function with a vector of values.</li>
<li>For this bootstrap example, we are going to write the function as one where we will supply the function with a dataframe. Let’s call this <code>df</code>.</li>
</ul></li>
<li>The inside part of the function, between the <code>{}</code> is the procedure from above. All we do is
<ul>
<li>Instead of writing <code>mids</code>, we keep it generic by writing <code>df</code>.</li>
<li>We add a final line that tells R what we want it to <code>return()</code> as the output of the function. Here, we want it to return the average predicted probability.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="uncertainty.html#cb389-1" aria-hidden="true" tabindex="-1"></a><span class="do">## We need to build our bootstrap function</span></span>
<span id="cb389-2"><a href="uncertainty.html#cb389-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 4: Let&#39;s wrap our current steps into a function that we can replicate</span></span>
<span id="cb389-3"><a href="uncertainty.html#cb389-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb389-4"><a href="uncertainty.html#cb389-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Note: all we need as an input is our data.frame mids</span></span>
<span id="cb389-5"><a href="uncertainty.html#cb389-5" aria-hidden="true" tabindex="-1"></a><span class="do">## I will label it something generic to show how a function can work</span></span>
<span id="cb389-6"><a href="uncertainty.html#cb389-6" aria-hidden="true" tabindex="-1"></a>myboot <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb389-7"><a href="uncertainty.html#cb389-7" aria-hidden="true" tabindex="-1"></a>  wrows <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x =</span><span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df), <span class="at">size =</span> <span class="fu">nrow</span>(df), <span class="at">replace =</span> T)</span>
<span id="cb389-8"><a href="uncertainty.html#cb389-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Create subset of data based on these rows</span></span>
<span id="cb389-9"><a href="uncertainty.html#cb389-9" aria-hidden="true" tabindex="-1"></a>  subdata <span class="ot">&lt;-</span> df[wrows, ]</span>
<span id="cb389-10"><a href="uncertainty.html#cb389-10" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Step 2: run your regression model with the new data</span></span>
<span id="cb389-11"><a href="uncertainty.html#cb389-11" aria-hidden="true" tabindex="-1"></a>  boot.logit <span class="ot">&lt;-</span><span class="fu">glm</span>(Conflict <span class="sc">~</span>  MajorPower <span class="sc">+</span> Contiguity <span class="sc">+</span> Allies <span class="sc">+</span> ForeignPolicy <span class="sc">+</span></span>
<span id="cb389-12"><a href="uncertainty.html#cb389-12" aria-hidden="true" tabindex="-1"></a>    BalanceOfPower <span class="sc">+</span> YearsSince, </span>
<span id="cb389-13"><a href="uncertainty.html#cb389-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), <span class="at">data =</span> subdata)</span>
<span id="cb389-14"><a href="uncertainty.html#cb389-14" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Step 3: generate average predicted probability</span></span>
<span id="cb389-15"><a href="uncertainty.html#cb389-15" aria-hidden="true" tabindex="-1"></a>  Xboot <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(boot.logit)</span>
<span id="cb389-16"><a href="uncertainty.html#cb389-16" aria-hidden="true" tabindex="-1"></a>  Xboot[, <span class="st">&quot;Allies&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb389-17"><a href="uncertainty.html#cb389-17" aria-hidden="true" tabindex="-1"></a>  Bh <span class="ot">&lt;-</span> <span class="fu">coef</span>(boot.logit)</span>
<span id="cb389-18"><a href="uncertainty.html#cb389-18" aria-hidden="true" tabindex="-1"></a>  p.boot <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">plogis</span>(Xboot <span class="sc">%*%</span> Bh))</span>
<span id="cb389-19"><a href="uncertainty.html#cb389-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p.boot)</span>
<span id="cb389-20"><a href="uncertainty.html#cb389-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Note: here, our quantity of interest is the predicted probability of a dispute when the dyad are Allies. Let’s say, instead, we wanted the difference in predicted probability of a dispute between Allies and Non-Allies. Well, we would just adjust our function to calculate the mean probabilities for Allies and Non-Allies and return the difference in these means as the quantity of interest. We would then get 10000 estimates of this <strong><em>difference</em></strong> in probabilties.</p>
<p>Now that we have the function from above, instead of copying/pasting this 1000 times, we will use the function called <code>replicate</code> which will do this for us. We indicate the number of estimates we want and then indicate which function (and in our case, which dataframe inside the function) we want to replicate.</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="uncertainty.html#cb390-1" aria-hidden="true" tabindex="-1"></a><span class="do">## This may take a minute to run. </span></span>
<span id="cb390-2"><a href="uncertainty.html#cb390-2" aria-hidden="true" tabindex="-1"></a><span class="do">## We will do just 50, Normally you will want this to be more like 1000</span></span>
<span id="cb390-3"><a href="uncertainty.html#cb390-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>) <span class="co"># this helps us get the same results each time, good for reproducibility</span></span>
<span id="cb390-4"><a href="uncertainty.html#cb390-4" aria-hidden="true" tabindex="-1"></a>myestimates <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">50</span>, <span class="fu">myboot</span>(mids))</span></code></pre></div>
<p>The bootstrapping approach is very computationally demanding given it has to repeat an operation several (thousand) times. After you hit “run,” just sit back, relax and wait for the <a href="https://www.youtube.com/watch?v=9N9opF-PK5k">water to run dry.</a></p>
<details>
<summary>
For a troubleshooting tip, expand.
</summary>
<p>If you get an error message at the <code>replicate(1000, myboot(mids))</code> stage, it is best to see if your function runs at all. Try just the below to see if it generates output:</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="uncertainty.html#cb391-1" aria-hidden="true" tabindex="-1"></a><span class="fu">myboot</span>(mids)</span></code></pre></div>
<pre><code>[1] 0.002250429</code></pre>
If you get the error here, then it means there is a bug within the function code, not the replicate code.
</details>
<p>Each time we replicate the function, it will generate slightly different results because the <code>sample</code> functions is randoming sampling rows of data each time. We can plot the distribution of estimates to show this.</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="uncertainty.html#cb393-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb393-2"><a href="uncertainty.html#cb393-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">x =</span> myestimates), <span class="fu">aes</span>(<span class="at">x =</span> myestimates)) <span class="sc">+</span> </span>
<span id="cb393-3"><a href="uncertainty.html#cb393-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y=</span>..density..)) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">color=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="mlebookout_files/figure-html/unnamed-chunk-171-1.svg" width="672" /></p>
<p>The final step after generating the bootstrap distribution of estimates is to use it to construct a confidence interval for the quantity of interest. There are a few ways to do this.</p>
<ul>
<li>Normal approximation</li>
<li>Percentile</li>
<li>Bias correction</li>
</ul>
<p>In each approach, we take our original “point estimate” from the computation of the quantity of interest from our original data and use the bootstrap estimates for the lower and upper bounds of the confidence interval. Here we will assume we want a 95% confidence interval.</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="uncertainty.html#cb395-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Find the original point estimate</span></span>
<span id="cb395-2"><a href="uncertainty.html#cb395-2" aria-hidden="true" tabindex="-1"></a>Bh <span class="ot">&lt;-</span> <span class="fu">coef</span>(out.logit)</span>
<span id="cb395-3"><a href="uncertainty.html#cb395-3" aria-hidden="true" tabindex="-1"></a>X1 <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(out.logit)</span>
<span id="cb395-4"><a href="uncertainty.html#cb395-4" aria-hidden="true" tabindex="-1"></a>X1[, <span class="st">&quot;Allies&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb395-5"><a href="uncertainty.html#cb395-5" aria-hidden="true" tabindex="-1"></a>pe1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">plogis</span>(X1 <span class="sc">%*%</span> Bh))</span>
<span id="cb395-6"><a href="uncertainty.html#cb395-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-7"><a href="uncertainty.html#cb395-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Normal</span></span>
<span id="cb395-8"><a href="uncertainty.html#cb395-8" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>((pe1 <span class="sc">-</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>)<span class="sc">*</span><span class="fu">sqrt</span>(<span class="fu">var</span>(myestimates))),(pe1 <span class="sc">+</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>)<span class="sc">*</span><span class="fu">sqrt</span>(<span class="fu">var</span>(myestimates))))</span></code></pre></div>
<pre><code>[1] 0.002174802 0.003345002</code></pre>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="uncertainty.html#cb397-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Percentile</span></span>
<span id="cb397-2"><a href="uncertainty.html#cb397-2" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(myestimates, <span class="fu">c</span>(<span class="fl">0.025</span>, .<span class="dv">975</span>))</span></code></pre></div>
<pre><code>       2.5%       97.5% 
0.002275356 0.003431285 </code></pre>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="uncertainty.html#cb399-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Bias correction</span></span>
<span id="cb399-2"><a href="uncertainty.html#cb399-2" aria-hidden="true" tabindex="-1"></a>bc <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span>pe1 <span class="sc">-</span> myestimates</span>
<span id="cb399-3"><a href="uncertainty.html#cb399-3" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(bc, <span class="fu">c</span>(<span class="fl">0.025</span>, .<span class="dv">975</span>))</span></code></pre></div>
<pre><code>       2.5%       97.5% 
0.002088520 0.003244449 </code></pre>
<p>Each of these is pretty commonly used, but they may generate slightly different results.</p>
</div>
<div id="simulated-confidence-intervals" class="section level3" number="7.3.2">
<h3><span class="header-section-number">7.3.2</span> Simulated Confidence Intervals</h3>
<p>Quasi-Bayesian or simulated confidence intervals take advantage of the large sample properties of our estimates <span class="math inline">\(\hat \beta\)</span> having a Normal sampling distribution due to the Central Limit Theorem.</p>
<p>Like the bootstrap, the simulation procedure also generates hypothetical new samples. However, here, we are sampling new <span class="math inline">\(\hat \beta\)</span> estimates each time instead of sampling a new underlying dataset each time. This allows use to skip the step of generating a new dataset and running the regression 1000 times. Here, we just run the regression model once. The simulation process takes place after this step.</p>
<p>Process</p>
<ul>
<li>Estimate your model (e.g., with <code>optim</code> or <code>glm</code>)</li>
<li>Sample <span class="math inline">\(\sim\)</span> 1000 new estimates of the vector of <span class="math inline">\(\hat \beta\)</span> by using the <code>vcov</code> of <span class="math inline">\(\hat \beta\)</span> to generate the uncertainty</li>
<li>For each of these new <span class="math inline">\(\hat \beta_c\)</span>, calculate <span class="math inline">\(\hat \theta_c\)</span>, in this case, the predicted probabilities.</li>
<li>Estimate “fundamental uncertainty” by drawing new y’s based on these parameters
<ul>
<li>Only necessary in some cases. Depends on Jensen’s Inequality discussed in the Gary King resources and in the details on the use of <code>rbinom</code> function below.</li>
<li>We are going to average over this, which means we are calculating “expected values.”</li>
</ul></li>
<li>Use this distribution to compute the CI’s</li>
</ul>
<p>This would be a good place to review the resources from Gary King:</p>
<ul>
<li>Overview of simulation approach for calculating uncertainty from <a href="https://gking.harvard.edu/files/abs/making-abs.shtml">King, Tomz, and Wittenberg 2000</a>.</li>
<li>Lecture video from Gary King on <a href="https://www.youtube.com/watch?v=gbokhfMdfE8">simulating quantities of interest</a></li>
</ul>
<p><strong><em>Example</em></strong></p>
<p>The code for this approach will more simple in a case where we are computing quantities of interest when covariates are held at means or representative values (cases where we get just one predicted probability associated with each set of <span class="math inline">\(X\)</span> values). It will look a little more complex in cases where we want to hold covariates at observed values and calculate the average predicted probability.</p>
<p>First, let’s find the point estimate and 95% CI for the predicted probability of conflict when the dyad are Allies, and all other covariates are held at zero.</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="uncertainty.html#cb401-1" aria-hidden="true" tabindex="-1"></a><span class="do">## install.packages(&quot;mvtnorm&quot;)</span></span>
<span id="cb401-2"><a href="uncertainty.html#cb401-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb401-3"><a href="uncertainty.html#cb401-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-4"><a href="uncertainty.html#cb401-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 2: Sample 1000 new Bhs (we will use 50 for this example)</span></span>
<span id="cb401-5"><a href="uncertainty.html#cb401-5" aria-hidden="true" tabindex="-1"></a><span class="do">## This uses the multivariate normal distribution for resampling</span></span>
<span id="cb401-6"><a href="uncertainty.html#cb401-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb401-7"><a href="uncertainty.html#cb401-7" aria-hidden="true" tabindex="-1"></a>numsims <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb401-8"><a href="uncertainty.html#cb401-8" aria-hidden="true" tabindex="-1"></a>qb.beta <span class="ot">&lt;-</span> <span class="fu">rmvnorm</span>(numsims, <span class="fu">coef</span>(out.logit), <span class="fu">vcov</span>(out.logit)) </span>
<span id="cb401-9"><a href="uncertainty.html#cb401-9" aria-hidden="true" tabindex="-1"></a><span class="do">## This generates numsims X k coefficients matrix</span></span>
<span id="cb401-10"><a href="uncertainty.html#cb401-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-11"><a href="uncertainty.html#cb401-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 3: Iterate through the estimates</span></span>
<span id="cb401-12"><a href="uncertainty.html#cb401-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Create an empty vector to store 1000 quantities of interest</span></span>
<span id="cb401-13"><a href="uncertainty.html#cb401-13" aria-hidden="true" tabindex="-1"></a>qestimatessimple <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, numsims)</span>
<span id="cb401-14"><a href="uncertainty.html#cb401-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-15"><a href="uncertainty.html#cb401-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Here, our covariate matrix stays the same each time</span></span>
<span id="cb401-16"><a href="uncertainty.html#cb401-16" aria-hidden="true" tabindex="-1"></a><span class="do">## We have a 1 for intercept and 1 for Allies, everything else at zero</span></span>
<span id="cb401-17"><a href="uncertainty.html#cb401-17" aria-hidden="true" tabindex="-1"></a>X1 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span> , <span class="dv">0</span>) </span>
<span id="cb401-18"><a href="uncertainty.html#cb401-18" aria-hidden="true" tabindex="-1"></a><span class="do">## X1 is a 1 X k matrix</span></span>
<span id="cb401-19"><a href="uncertainty.html#cb401-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-20"><a href="uncertainty.html#cb401-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Use a loop to iterate through each set of betas</span></span>
<span id="cb401-21"><a href="uncertainty.html#cb401-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>numsims){</span>
<span id="cb401-22"><a href="uncertainty.html#cb401-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb401-23"><a href="uncertainty.html#cb401-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">## for each set of betas, calculate p probs</span></span>
<span id="cb401-24"><a href="uncertainty.html#cb401-24" aria-hidden="true" tabindex="-1"></a>  <span class="do">## for a given set of betas, this gives us nrow(X1) predicted probabilities</span></span>
<span id="cb401-25"><a href="uncertainty.html#cb401-25" aria-hidden="true" tabindex="-1"></a>  pestimate <span class="ot">&lt;-</span><span class="fu">plogis</span>(X1 <span class="sc">%*%</span> qb.beta[i,])</span>
<span id="cb401-26"><a href="uncertainty.html#cb401-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb401-27"><a href="uncertainty.html#cb401-27" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Fundamental uncertainty</span></span>
<span id="cb401-28"><a href="uncertainty.html#cb401-28" aria-hidden="true" tabindex="-1"></a>  <span class="do">## not required for logit/probit, but we will show how</span></span>
<span id="cb401-29"><a href="uncertainty.html#cb401-29" aria-hidden="true" tabindex="-1"></a>  <span class="do">## rbinom generates 1000 0&#39;s or 1&#39;s based on the predicted probability</span></span>
<span id="cb401-30"><a href="uncertainty.html#cb401-30" aria-hidden="true" tabindex="-1"></a>  <span class="do">## We use rbinom bc of the bernoulli, other glm&#39;s will have other distributions</span></span>
<span id="cb401-31"><a href="uncertainty.html#cb401-31" aria-hidden="true" tabindex="-1"></a>  <span class="do">## then we take the mean to get our estimate of the predicted probability</span></span>
<span id="cb401-32"><a href="uncertainty.html#cb401-32" aria-hidden="true" tabindex="-1"></a>  moutcome <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">rbinom</span>(numsims, <span class="dv">1</span>, pestimate))</span>
<span id="cb401-33"><a href="uncertainty.html#cb401-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb401-34"><a href="uncertainty.html#cb401-34" aria-hidden="true" tabindex="-1"></a>  qestimatessimple[i] <span class="ot">&lt;-</span>moutcome</span>
<span id="cb401-35"><a href="uncertainty.html#cb401-35" aria-hidden="true" tabindex="-1"></a>  <span class="do">## repeat for set of simulated betas</span></span>
<span id="cb401-36"><a href="uncertainty.html#cb401-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb401-37"><a href="uncertainty.html#cb401-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-38"><a href="uncertainty.html#cb401-38" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 4: Similar to bootstrap distribution, find CI using the percentiles</span></span>
<span id="cb401-39"><a href="uncertainty.html#cb401-39" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(qestimatessimple, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span></code></pre></div>
<pre><code> 2.5% 97.5% 
 0.00  0.02 </code></pre>
<p>For more information on loops in R, you can follow this <a href="https://drive.google.com/file/d/18sX5B5bXum0WPC5sRhQIHtJAwEh76VIn/view?usp=sharing">tutorial</a> we created for 2020 SICSS-Rutgers.</p>
<details>
<summary>
Expand for details on rbinom.
</summary>
<p><code>rbinom</code> is the random generation function for the binomial distribution. If we supply it with number of trials (in the Bernoulli, this is 1), and a probability of success, it will generate our desired number of outcomes according to this distribution.</p>
<p>For example, let’s say we wanted to generate a random set of 100 coin flips for a coin that is fair– where the probability of success is .5. We will get a sample of 0’s and 1’s. If we take the mean, it will be close to .5, and with enough coin flips, will converge on .5.</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="uncertainty.html#cb403-1" aria-hidden="true" tabindex="-1"></a>rb.res <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">100</span>, <span class="dv">1</span>, .<span class="dv">5</span>)</span>
<span id="cb403-2"><a href="uncertainty.html#cb403-2" aria-hidden="true" tabindex="-1"></a>rb.res</span></code></pre></div>
<pre><code>  [1] 0 1 0 0 0 0 1 0 0 0 1 0 1 1 0 1 0 1 0 0 1 0 1 0 1 1 0 1 0 1 0 1 1 1 1 0 0
 [38] 0 0 0 0 1 1 1 1 0 1 0 1 0 1 1 0 1 1 0 0 0 0 0 0 1 1 0 0 1 0 1 0 0 0 0 1 1
 [75] 1 1 1 1 0 0 1 0 1 0 0 1 0 1 1 0 1 1 1 1 1 1 0 1 0 0</code></pre>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="uncertainty.html#cb405-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(rb.res)</span></code></pre></div>
<pre><code>[1] 0.49</code></pre>
<p>In logit/probit, this step is unneccessary because the <span class="math inline">\(\mathbb{E}(y_i) = \pi_i\)</span>. When we take the mean of our <code>rbinom</code> estimates, we are just going to recover the probability we supplied to it.</p>
<p>However, in other cases, Jensen’s inequality may apply, which states that <span class="math inline">\(\mathbb{E}[g(X)] \neq g(\mathbb{E}[X])\)</span>. For example, if we have an outcome that is distributed according to the exponential distribution: Here, the <span class="math inline">\(\theta\)</span> is <span class="math inline">\(\lambda\)</span> where <span class="math inline">\(\lambda = \frac{1}{e^{X\beta}}\)</span> but <span class="math inline">\(\mathbb{E}(y)= \frac{1}{\lambda}\)</span>. Unfortunately, <span class="math inline">\(\mathbb{E}(\frac{1}{\hat \lambda}) \neq \frac{1}{\mathbb{E}(\hat \lambda)} = \frac{1}{\mathbb{E}(e^{X\beta})}\)</span>. For that example, the <code>rexp()</code> step in this case would be essential.</p>
If we’re not sure when Jensen’s inequality will apply, we can just keep the fundamental uncertainty step as part of the process.
</details>
<p>Find the point estimate and 95% CI for the average predicted probability of conflict when the dyad are allies and all other covariates are held at observed values. Here, the code is more complicated, because every time we generate a predicted probability (for any observed value), we need to go through the fundamental uncertainty step (when applicable).</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="uncertainty.html#cb407-1" aria-hidden="true" tabindex="-1"></a><span class="do">## install.packages(&quot;mvtnorm&quot;)</span></span>
<span id="cb407-2"><a href="uncertainty.html#cb407-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb407-3"><a href="uncertainty.html#cb407-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb407-4"><a href="uncertainty.html#cb407-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 2: Sample 1000 new Bhs (we will use 50 for this example)</span></span>
<span id="cb407-5"><a href="uncertainty.html#cb407-5" aria-hidden="true" tabindex="-1"></a><span class="do">## This uses the multivariate normal distribution for resampling</span></span>
<span id="cb407-6"><a href="uncertainty.html#cb407-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb407-7"><a href="uncertainty.html#cb407-7" aria-hidden="true" tabindex="-1"></a>numsims <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb407-8"><a href="uncertainty.html#cb407-8" aria-hidden="true" tabindex="-1"></a>qb.beta <span class="ot">&lt;-</span> <span class="fu">rmvnorm</span>(numsims, <span class="fu">coef</span>(out.logit), <span class="fu">vcov</span>(out.logit)) </span>
<span id="cb407-9"><a href="uncertainty.html#cb407-9" aria-hidden="true" tabindex="-1"></a><span class="do">## This generates numsims X k coefficients matrix</span></span>
<span id="cb407-10"><a href="uncertainty.html#cb407-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb407-11"><a href="uncertainty.html#cb407-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 3: Iterate through the estimates</span></span>
<span id="cb407-12"><a href="uncertainty.html#cb407-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Create an empty vector to store 1000 quantities of interest</span></span>
<span id="cb407-13"><a href="uncertainty.html#cb407-13" aria-hidden="true" tabindex="-1"></a>qestimates <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, numsims)</span>
<span id="cb407-14"><a href="uncertainty.html#cb407-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb407-15"><a href="uncertainty.html#cb407-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Here, our covariate matrix stays the same</span></span>
<span id="cb407-16"><a href="uncertainty.html#cb407-16" aria-hidden="true" tabindex="-1"></a>X1 <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(out.logit)</span>
<span id="cb407-17"><a href="uncertainty.html#cb407-17" aria-hidden="true" tabindex="-1"></a>X1[, <span class="st">&quot;Allies&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb407-18"><a href="uncertainty.html#cb407-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb407-19"><a href="uncertainty.html#cb407-19" aria-hidden="true" tabindex="-1"></a><span class="do">## Use a loop to </span></span>
<span id="cb407-20"><a href="uncertainty.html#cb407-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>numsims){</span>
<span id="cb407-21"><a href="uncertainty.html#cb407-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb407-22"><a href="uncertainty.html#cb407-22" aria-hidden="true" tabindex="-1"></a>  <span class="do">## for each set of betas, calculate p probs</span></span>
<span id="cb407-23"><a href="uncertainty.html#cb407-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">## for a given set of betas, this gives us nrow(X1) predicted probabilities</span></span>
<span id="cb407-24"><a href="uncertainty.html#cb407-24" aria-hidden="true" tabindex="-1"></a>  pestimates <span class="ot">&lt;-</span><span class="fu">plogis</span>(X1 <span class="sc">%*%</span> qb.beta[i,])</span>
<span id="cb407-25"><a href="uncertainty.html#cb407-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb407-26"><a href="uncertainty.html#cb407-26" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Fundamental uncertainty</span></span>
<span id="cb407-27"><a href="uncertainty.html#cb407-27" aria-hidden="true" tabindex="-1"></a>  <span class="do">## not required for logit/probit, but we will show how</span></span>
<span id="cb407-28"><a href="uncertainty.html#cb407-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb407-29"><a href="uncertainty.html#cb407-29" aria-hidden="true" tabindex="-1"></a>  <span class="do">## generate empty vector for outcomes</span></span>
<span id="cb407-30"><a href="uncertainty.html#cb407-30" aria-hidden="true" tabindex="-1"></a>  moutcomes <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, numsims)</span>
<span id="cb407-31"><a href="uncertainty.html#cb407-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb407-32"><a href="uncertainty.html#cb407-32" aria-hidden="true" tabindex="-1"></a>  <span class="do">## for each probability estimate, calculate the mean of simulated y&#39;s</span></span>
<span id="cb407-33"><a href="uncertainty.html#cb407-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pestimates)){</span>
<span id="cb407-34"><a href="uncertainty.html#cb407-34" aria-hidden="true" tabindex="-1"></a>    <span class="do">## rbinom generates 1000 0&#39;s or 1&#39;s based on the predicted probability</span></span>
<span id="cb407-35"><a href="uncertainty.html#cb407-35" aria-hidden="true" tabindex="-1"></a>    <span class="do">## We use rbinom bc of the bernoulli, other glm&#39;s will have other distributions</span></span>
<span id="cb407-36"><a href="uncertainty.html#cb407-36" aria-hidden="true" tabindex="-1"></a>    <span class="do">## then we take the mean to get our estimate of the predicted probability for a given observation</span></span>
<span id="cb407-37"><a href="uncertainty.html#cb407-37" aria-hidden="true" tabindex="-1"></a>    moutcomes[j] <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">rbinom</span>(numsims, <span class="dv">1</span>, pestimates[j]))</span>
<span id="cb407-38"><a href="uncertainty.html#cb407-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb407-39"><a href="uncertainty.html#cb407-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb407-40"><a href="uncertainty.html#cb407-40" aria-hidden="true" tabindex="-1"></a>  <span class="do">## take the mean of the predicted probability estimates across all observations</span></span>
<span id="cb407-41"><a href="uncertainty.html#cb407-41" aria-hidden="true" tabindex="-1"></a>  qestimates[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(moutcomes)</span>
<span id="cb407-42"><a href="uncertainty.html#cb407-42" aria-hidden="true" tabindex="-1"></a>  <span class="do">## repeat for set of simulated betas</span></span>
<span id="cb407-43"><a href="uncertainty.html#cb407-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb407-44"><a href="uncertainty.html#cb407-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb407-45"><a href="uncertainty.html#cb407-45" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 4: Similar to bootstrap distribution, find CI using the percentiles</span></span>
<span id="cb407-46"><a href="uncertainty.html#cb407-46" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(qestimates, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span></code></pre></div>
<pre><code>      2.5%      97.5% 
0.00232977 0.00344796 </code></pre>
<p>Because the shortcut applies where we do not need to calculate fundamental uncertainty in the logit / probit case, we can simplify this to:</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="uncertainty.html#cb409-1" aria-hidden="true" tabindex="-1"></a><span class="do">## install.packages(&quot;mvtnorm&quot;)</span></span>
<span id="cb409-2"><a href="uncertainty.html#cb409-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb409-3"><a href="uncertainty.html#cb409-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-4"><a href="uncertainty.html#cb409-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 2: Sample 1000 new Bhs (we will use 50 for this example)</span></span>
<span id="cb409-5"><a href="uncertainty.html#cb409-5" aria-hidden="true" tabindex="-1"></a><span class="do">## This uses the multivariate normal distribution for resampling</span></span>
<span id="cb409-6"><a href="uncertainty.html#cb409-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb409-7"><a href="uncertainty.html#cb409-7" aria-hidden="true" tabindex="-1"></a>numsims <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb409-8"><a href="uncertainty.html#cb409-8" aria-hidden="true" tabindex="-1"></a>qb.beta <span class="ot">&lt;-</span> <span class="fu">rmvnorm</span>(numsims, <span class="fu">coef</span>(out.logit), <span class="fu">vcov</span>(out.logit)) </span>
<span id="cb409-9"><a href="uncertainty.html#cb409-9" aria-hidden="true" tabindex="-1"></a><span class="do">## This generates numsims X k coefficients matrix</span></span>
<span id="cb409-10"><a href="uncertainty.html#cb409-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-11"><a href="uncertainty.html#cb409-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 3: Iterate through the estimates</span></span>
<span id="cb409-12"><a href="uncertainty.html#cb409-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Create an empty vector to store 1000 quantities of interest</span></span>
<span id="cb409-13"><a href="uncertainty.html#cb409-13" aria-hidden="true" tabindex="-1"></a>qestimates <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, numsims)</span>
<span id="cb409-14"><a href="uncertainty.html#cb409-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-15"><a href="uncertainty.html#cb409-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Here, our covariate matrix stays the same</span></span>
<span id="cb409-16"><a href="uncertainty.html#cb409-16" aria-hidden="true" tabindex="-1"></a>X1 <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(out.logit)</span>
<span id="cb409-17"><a href="uncertainty.html#cb409-17" aria-hidden="true" tabindex="-1"></a>X1[, <span class="st">&quot;Allies&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb409-18"><a href="uncertainty.html#cb409-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-19"><a href="uncertainty.html#cb409-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>numsims){</span>
<span id="cb409-20"><a href="uncertainty.html#cb409-20" aria-hidden="true" tabindex="-1"></a>  pestimates <span class="ot">&lt;-</span><span class="fu">plogis</span>(X1 <span class="sc">%*%</span> qb.beta[i,])</span>
<span id="cb409-21"><a href="uncertainty.html#cb409-21" aria-hidden="true" tabindex="-1"></a>  qestimates[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(pestimates)</span>
<span id="cb409-22"><a href="uncertainty.html#cb409-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb409-23"><a href="uncertainty.html#cb409-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-24"><a href="uncertainty.html#cb409-24" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 4: Similar to bootstrap distribution, find CI using the percentiles</span></span>
<span id="cb409-25"><a href="uncertainty.html#cb409-25" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(qestimates, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span></code></pre></div>
<pre><code>       2.5%       97.5% 
0.002314344 0.003419644 </code></pre>
<p>We can also plot the distribution of estimates</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="uncertainty.html#cb411-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb411-2"><a href="uncertainty.html#cb411-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">x =</span> qestimates), <span class="fu">aes</span>(<span class="at">x =</span> qestimates)) <span class="sc">+</span> </span>
<span id="cb411-3"><a href="uncertainty.html#cb411-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y=</span>..density..)) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">color=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="mlebookout_files/figure-html/unnamed-chunk-177-1.svg" width="672" /></p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="qoi-at-designated-values.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visualizing-results.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
